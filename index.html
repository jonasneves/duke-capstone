<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<link rel="icon" type="image/svg+xml" href="./favicon.svg">
<style>
body{margin:0;display:flex;align-items:center;justify-content:center;min-height:100vh;background:linear-gradient(135deg,#667eea,#764ba2)}
.s{border:3px solid rgba(255,255,255,.3);border-radius:50%;border-top-color:#fff;width:40px;height:40px;animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
#a{display:none;width:100%;height:100vh}
#a.loaded{display:block}
</style>
</head>
<body>
<div id="l"><div class="s"></div></div>
<div id="a"></div>
<script src="https://oauth.neevs.io/github-auth.js?v=2" integrity="sha384-yCvoyjf6LKk2Yc6oSRenxRV0yFNdjeQ5ANuXIcRN50VoX/X8S4YJ9mU2+cT9MGW1" crossorigin="anonymous"></script>
<script>
GitHubAuth.init({
  autoRedirect: true,
  onLogin: async function(user) {
    try {
      const params = new URLSearchParams(window.location.search);
      const token = params.get("token") || GitHubAuth.getToken();

      if (!token) throw new Error("No token");

      window.__INJECTED_TOKEN = token;
      window.__INJECTED_USER = user;

      const response = await fetch("https://api.github.com/repos/jonasneves/duke-capstone/contents/index.html", {
        headers: {
          Authorization: `Bearer ${token}`,
          "Accept": "application/vnd.github.v3+json"
        }
      });

      if (!response.ok) throw new Error("Failed to fetch");

      const data = await response.json();
      const html = decodeURIComponent(escape(atob(data.content.replace(/\s/g, ''))));

      document.getElementById("l").style.display = "none";

      const appContainer = document.getElementById("a");
      appContainer.innerHTML = html;
      appContainer.classList.add("loaded");

      const scripts = appContainer.getElementsByTagName("script");
      for (let script of scripts) {
        const newScript = document.createElement("script");
        if (script.src) {
          newScript.src = script.src;
        } else {
          newScript.textContent = script.textContent;
        }
        document.body.appendChild(newScript);
      }
    } catch (error) {
      console.error("Load error:", error);
      document.getElementById("l").innerHTML = '<div class="s" style="border-top-color:#f66"></div>';
    }
  }
});
</script>
</body>
</html>
