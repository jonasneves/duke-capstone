import{j as e,A as v}from"./main-BFfeUCmg.js";import{r}from"./state-DOKsaQ-a.js";import{F as E,a as F,S as D,X as L}from"./ui-BzbG-TcE.js";import{u as P}from"./index-DXK1WN_P.js";import{u as I}from"./usePerformanceMonitor-BK8VJ-1X.js";import"./vendor-CZvkgD4c.js";function $({files:s,onFileSelect:i,selectedFile:u,onLoadDirectory:f}){const[c,n]=r.useState({}),m=async t=>{const l=c[t.path]||{isOpen:!1,children:[],isLoaded:!1};if(l.isOpen){n(a=>({...a,[t.path]:{...l,isOpen:!1}}));return}if(l.isLoaded)n(a=>({...a,[t.path]:{...l,isOpen:!0}}));else{const a=await f(t.path);n(d=>({...d,[t.path]:{isOpen:!0,children:a,isLoaded:!0}}))}},h=(t,l=0)=>{const a=t.type==="dir",d=c[t.path],p=d?.isOpen||!1,y=u?.path===t.path;return a?e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 px-2 py-1.5 hover:bg-neutral-100 cursor-pointer text-sm text-neutral-700 transition-colors",style:{paddingLeft:`${l*16+16}px`},onClick:()=>m(t),children:[e.jsx(E,{size:16,className:p?"text-brand-600":""}),e.jsx("span",{className:"font-medium",children:t.name})]}),p&&d.children.length>0&&e.jsx("div",{children:d.children.map(b=>h(b,l+1))})]},t.path):e.jsxs("div",{className:`flex items-center gap-2 px-2 py-1.5 hover:bg-neutral-100 cursor-pointer text-sm transition-colors ${y?"bg-brand-50 text-brand-700":"text-neutral-600"}`,style:{paddingLeft:`${l*16+16}px`},onClick:()=>i(t),children:[e.jsx(F,{size:16}),e.jsx("span",{children:t.name})]},t.path)};return e.jsx("div",{children:s.map(t=>h(t))})}function M({content:s,onChange:i,disabled:u,placeholder:f}){const c=r.useRef(null);return r.useEffect(()=>{s&&c.current&&c.current.focus()},[s]),e.jsxs("div",{className:"flex flex-col flex-1 overflow-hidden",children:[e.jsx("h3",{className:"px-6 py-3 bg-neutral-50 border-b border-neutral-200 font-medium text-sm text-neutral-700",children:"Editor"}),e.jsx("textarea",{ref:c,id:"editor",value:s,onChange:n=>i(n.target.value),disabled:u,placeholder:f||"Select a file to edit...",className:"flex-1 w-full px-6 py-4 font-mono text-sm text-neutral-900 resize-none focus:outline-none disabled:bg-neutral-50 disabled:text-neutral-400"})]})}function O(){const[s,i]=r.useState(""),[u,f]=r.useState(!1),[c,n]=r.useState(null),m=r.useRef(null),h=r.useRef(0),t=r.useRef(null);r.useEffect(()=>{const a=new Worker(new URL(""+new URL("markdown.worker-Dti5hhgv.js",import.meta.url).href,import.meta.url),{type:"module"});return a.onmessage=d=>{const{id:p,html:y,error:b}=d.data;if(p==="ready"){f(!0);return}t.current===p&&(b?n(b):(i(y),n(null)),t.current=null)},a.onerror=d=>{console.error("Markdown worker error:",d),n("Worker error occurred"),f(!1)},m.current=a,()=>{a.terminate()}},[]);const l=r.useCallback(a=>{if(!m.current||!u)return;const d=`request-${++h.current}`;t.current=d;const p={id:d,markdown:a};m.current.postMessage(p)},[u]);return{html:s,parse:l,isReady:u,error:c}}function T(s,i){const[u,f]=r.useState(s);return r.useEffect(()=>{const c=setTimeout(()=>{f(s)},i);return()=>{clearTimeout(c)}},[s,i]),u}function _({content:s,isMarkdown:i}){const{html:u,parse:f,isReady:c,error:n}=O(),m=T(s,300);return r.useEffect(()=>{i&&c&&m&&f(m)},[m,i,c,f]),i?n?e.jsxs("div",{className:"flex flex-col flex-1 bg-white border-l border-neutral-200 overflow-hidden",children:[e.jsx("h3",{className:"px-6 py-3 bg-neutral-50 border-b border-neutral-200 font-medium text-sm text-neutral-700",children:"Preview"}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-4",children:e.jsxs("div",{className:"text-center text-red-600 py-8",children:["Error: ",n]})})]}):s?e.jsxs("div",{className:"flex flex-col flex-1 bg-white border-l border-neutral-200 overflow-hidden",children:[e.jsx("h3",{className:"px-6 py-3 bg-neutral-50 border-b border-neutral-200 font-medium text-sm text-neutral-700",children:"Preview"}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-4 prose prose-sm max-w-none",dangerouslySetInnerHTML:{__html:u}})]}):e.jsxs("div",{className:"flex flex-col flex-1 bg-white border-l border-neutral-200 overflow-hidden",children:[e.jsx("h3",{className:"px-6 py-3 bg-neutral-50 border-b border-neutral-200 font-medium text-sm text-neutral-700",children:"Preview"}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-4",children:e.jsx("div",{className:"text-center text-neutral-400 py-8",children:"Preview will appear here for markdown files"})})]}):e.jsxs("div",{className:"flex flex-col flex-1 bg-white border-l border-neutral-200 overflow-hidden",children:[e.jsx("h3",{className:"px-6 py-3 bg-neutral-50 border-b border-neutral-200 font-medium text-sm text-neutral-700",children:"Preview"}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-4",children:e.jsx("div",{className:"text-center text-neutral-400 py-8",children:"Preview available for markdown files only"})})]})}function V(){const s=P(v.repository.owner,v.repository.name),{startTimer:i,endTimer:u}=I("cms"),[f,c]=r.useState([]),[n,m]=r.useState(null),[h,t]=r.useState(""),[l,a]=r.useState(!1),[d,p]=r.useState(!1),[y,b]=r.useState(!0),g=r.useCallback(o=>o.filter(x=>!x.name.startsWith(".")&&x.name!=="node_modules"),[]);r.useEffect(()=>{w()},[]);const w=async()=>{try{b(!0);const o=await s.listDirectory("");c(g(o))}catch(o){console.error("Error loading directory:",o),alert(`Error: ${o.message}`)}finally{b(!1)}},j=r.useCallback(async o=>{try{const x=await s.listDirectory(o);return g(x)}catch(x){return console.error("Error loading directory:",x),[]}},[s,g]),N=r.useCallback(async o=>{if(o.type!=="dir"&&!(l&&!confirm("You have unsaved changes. Discard them?")))try{const x=await s.getFile(o.path);m(x),t(x.content),a(!1)}catch(x){alert(`Error loading file: ${x.message}`)}},[s,l]),S=r.useCallback(o=>{t(o),a(!0)},[]),C=r.useCallback(async()=>{if(!(!n||!l)){p(!0);try{i("save_latency_ms");const o=`Update ${n.path.split("/").pop()}`;await s.updateFile(n.path,h,n.sha,o);const x=await s.getFile(n.path);u("save_latency_ms"),m(x),a(!1),alert("Saved successfully!")}catch(o){alert(`Error saving: ${o.message}`)}finally{p(!1)}}},[n,h,l,s,i,u]),k=()=>{l&&!confirm("You have unsaved changes. Close anyway?")||window.parent.postMessage("close-app","*")},R=n?.path.endsWith(".md")||!1;return e.jsxs("div",{className:"flex flex-col h-screen bg-neutral-50",children:[e.jsxs("div",{className:"bg-white border-b border-neutral-200 px-6 py-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-semibold text-neutral-900",children:"Content Manager"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{className:"inline-flex items-center gap-2 px-4 py-2 bg-brand-600 hover:bg-brand-700 text-white rounded-lg font-medium text-sm transition-colors disabled:bg-neutral-300 disabled:cursor-not-allowed",onClick:C,disabled:!l||d,children:[e.jsx(D,{size:16}),d?"Saving...":"Save"]}),e.jsxs("button",{className:"inline-flex items-center gap-2 px-4 py-2 bg-white hover:bg-neutral-100 border border-neutral-300 text-neutral-700 rounded-lg font-medium text-sm transition-colors",onClick:k,children:[e.jsx(L,{size:16}),"Close"]})]})]}),e.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[e.jsxs("div",{className:"w-64 bg-white border-r border-neutral-200 overflow-y-auto",children:[e.jsx("div",{className:"px-4 py-3 bg-neutral-50 border-b border-neutral-200 font-medium text-sm text-neutral-700",children:"Repository Files"}),y?e.jsx("div",{className:"p-5 text-center text-neutral-400",children:"Loading..."}):e.jsx($,{files:f,onFileSelect:N,selectedFile:n?{...n,type:"file"}:null,onLoadDirectory:j})]}),e.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[e.jsx(M,{content:h,onChange:S,disabled:!n}),e.jsx(_,{content:h,isMarkdown:R})]})]})]})}export{V as default};
