import{j as e,b as $,u as D,c as I,a as U,A as y}from"./main--BmFQgzi.js";import{r as i}from"./state-DOKsaQ-a.js";import{R as F,T as J,L as q,C as M,b as P,c as R}from"./ui-D_bnl3Nn.js";import{u as V}from"./index-ChcGP1se.js";import"./vendor-CZvkgD4c.js";function W({children:r,oauthServiceUrl:t,onAuthChange:o,isAuthenticated:d}){const[n,a]=i.useState(!0),[c,p]=i.useState(!1);return i.useEffect(()=>{const s=document.createElement("script");return s.src=`${t}/github-auth.js?v=${Date.now()}`,s.async=!0,s.onload=()=>{setTimeout(()=>{window.GitHubAuth?p(!0):(console.error("GitHubAuth not available after script load"),a(!1))},100)},s.onerror=()=>{console.error("Failed to load OAuth script"),a(!1)},document.head.appendChild(s),()=>{document.head.contains(s)&&document.head.removeChild(s)}},[t]),i.useEffect(()=>{if(c)if(window.GitHubAuth.isAuthenticated()){const s=window.GitHubAuth.getUser(),x=window.GitHubAuth.getToken();s&&x&&setTimeout(()=>{o(x,s),a(!1)},0)}else window.GitHubAuth.init({scope:"repo",onLogin:s=>{const x=window.GitHubAuth.getUser();x&&setTimeout(()=>{o(s,x),a(!1)},0)}}),a(!1)},[c,o]),n?e.jsx("div",{className:"loading",children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{border:"4px solid rgba(255,255,255,0.3)",borderRadius:"50%",borderTopColor:"white",width:"50px",height:"50px",animation:"spin 1s linear infinite",margin:"0 auto 20px"}}),e.jsx("p",{children:"Initializing..."})]})}):d?e.jsx(e.Fragment,{children:r}):e.jsx("div",{className:"loading",children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("h2",{children:"Authentication Required"}),e.jsx("p",{style:{marginTop:16,marginBottom:24,opacity:.9},children:"Please sign in with GitHub to access the gallery"}),e.jsx("button",{onClick:()=>window.GitHubAuth.login(),style:{background:"linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)",color:"white",border:"none",padding:"12px 24px",borderRadius:"8px",fontSize:"16px",fontWeight:"500",cursor:"pointer"},children:"Sign in with GitHub"})]})})}function L({user:r,onLogout:t,onClearCache:o}){const[d,n]=i.useState(!1),a=i.useRef(null);i.useEffect(()=>{function p(s){a.current&&!a.current.contains(s.target)&&n(!1)}return document.addEventListener("click",p),()=>document.removeEventListener("click",p)},[]);const c=()=>{confirm("Clear all cached data? Apps will reload from the repository.")&&(o(),window.location.reload())};return r?e.jsxs("div",{ref:a,className:"fixed top-6 right-6 z-50",children:[e.jsxs("button",{onClick:()=>n(!d),className:"flex items-center gap-3 bg-white/80 backdrop-blur-md border border-neutral-200 rounded-full px-4 py-2 hover:bg-white transition-all duration-200 shadow-sm",children:[e.jsx("img",{src:r.avatar_url,alt:r.login,className:"w-8 h-8 rounded-full ring-2 ring-white"}),e.jsx("span",{className:"text-sm font-medium text-neutral-900",children:r.name||r.login})]}),e.jsxs("div",{className:`absolute top-14 right-0 bg-white border border-neutral-200 rounded-2xl shadow-xl min-w-[200px] overflow-hidden transition-all duration-200 ${d?"opacity-100 visible translate-y-0":"opacity-0 invisible -translate-y-2"}`,children:[e.jsxs("button",{onClick:()=>window.location.reload(),className:"w-full flex items-center gap-3 px-4 py-3 text-sm text-neutral-700 hover:bg-neutral-50 transition-colors",children:[e.jsx(F,{size:16})," Refresh"]}),e.jsxs("button",{onClick:c,className:"w-full flex items-center gap-3 px-4 py-3 text-sm text-neutral-700 hover:bg-neutral-50 transition-colors border-t border-neutral-100",children:[e.jsx(J,{size:16})," Clear Cache"]}),e.jsxs("button",{onClick:t,className:"w-full flex items-center gap-3 px-4 py-3 text-sm text-red-600 hover:bg-red-50 transition-colors border-t border-neutral-100",children:[e.jsx(q,{size:16})," Logout"]})]})]}):null}function K(r,t){if(!r?.minLauncherVersion||!t)return null;const o=t.split(".").map(Number),d=r.minLauncherVersion.split(".").map(Number);for(let n=0;n<3;n++){if(o[n]<d[n])return`Requires launcher v${r.minLauncherVersion}`;if(o[n]>d[n])return null}return null}function B({appName:r,manifest:t,path:o,onLaunch:d,version:n}){if(!t)return e.jsx("div",{className:"bg-white rounded-2xl border border-neutral-200 shadow-sm overflow-hidden",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-neutral-900 mb-2",children:r}),e.jsx("p",{className:"text-neutral-400",children:"Loading..."})]})});const a=K(t,n);return e.jsxs("div",{className:"bg-white rounded-2xl border border-neutral-200 shadow-sm hover:shadow-lg hover:-translate-y-1 transition-all duration-300 overflow-hidden group",children:[t.thumbnail&&e.jsx("img",{src:t.thumbnail,alt:t.name,className:"w-full h-48 object-cover",onError:c=>{c.currentTarget.style.display="none"}}),e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-neutral-900 mb-2",children:t.name}),e.jsx("p",{className:"text-neutral-600 text-sm leading-relaxed mb-4",children:t.description}),a&&e.jsxs("div",{className:"flex items-center gap-2 text-amber-600 text-xs mb-4 bg-amber-50 px-3 py-2 rounded-lg",children:[e.jsx(M,{size:14}),a]}),t.tech&&t.tech.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:t.tech.map(c=>e.jsx("span",{className:"bg-neutral-100 text-neutral-700 px-3 py-1 rounded-full text-xs font-medium",children:c},c))}),e.jsxs("button",{onClick:()=>d(o,t.name),className:"inline-flex items-center gap-2 bg-gradient-to-r from-brand-600 to-brand-700 hover:from-brand-700 hover:to-brand-800 text-white px-5 py-2.5 rounded-xl font-medium text-sm transition-all duration-200 group-hover:gap-3",children:["Launch App",e.jsx(P,{size:16,className:"transition-transform duration-200"})]})]})]})}function Q({config:r,user:t,token:o,useGitHubAPI:d,onLogout:n,onClearCache:a,onTrack:c,onNavigate:p}){const[s,x]=i.useState([]),[z,A]=i.useState(!0),[k,T]=i.useState(null),[w,E]=i.useState(null),[H,j]=i.useState(!1),[G,C]=i.useState(!1),v=d(r.repository.owner,r.repository.name),h=i.useRef(null);i.useEffect(()=>{_()},[]),i.useEffect(()=>{function l(m){m.key==="Escape"&&w&&S()}return window.addEventListener("keydown",l),()=>window.removeEventListener("keydown",l)},[w]),i.useEffect(()=>{function l(m){m.data==="close-app"&&S()}return window.addEventListener("message",l),()=>window.removeEventListener("message",l)},[]);const _=async()=>{try{A(!0);const m=(await v.listDirectory("apps")).filter(u=>u.type==="dir"),f=m.map(u=>({name:u.name,path:u.path,manifest:null}));x(f);for(let u=0;u<m.length;u++){await new Promise(b=>setTimeout(b,u*100));const N=await v.getManifest(m[u].path);N&&x(b=>b.map(g=>g.name===m[u].name?{...g,manifest:N}:g))}A(!1)}catch(l){T(l.message),A(!1)}},O=i.useCallback(async(l,m)=>{try{j(!0),c?.("app_launch",{appName:m,appPath:l});const f=s.find(g=>g.path===l)?.manifest;if(f?.reactRoute&&p){p(f.reactRoute),j(!1);return}E({path:l,name:m});const u=await v.getFile(`${l}/index.html`),N=`<script>
        window.INJECTED_TOKEN = ${JSON.stringify(o)};
        window.INJECTED_USER = ${JSON.stringify(t)};
        window.PARENT_REPO = window.parent.repo;
      <\/script>`,b=u.content.replace("<head>","<head>"+N);h.current&&(h.current.srcdoc=b,h.current.onload=()=>{j(!1),C(!0),setTimeout(()=>C(!1),3e3)})}catch(f){alert(`Error loading app: ${f.message}`),j(!1),E(null)}},[v,o,t,c,s,p]),S=i.useCallback(()=>{E(null),C(!1),h.current&&(h.current.srcdoc="")},[]);return z&&s.length===0?e.jsxs("div",{className:"relative min-h-screen",children:[e.jsx("div",{className:"fixed top-[70%] left-[75%] -translate-x-1/2 -translate-y-1/2 w-[300px] h-[300px] sm:w-[600px] sm:h-[600px] rounded-full bg-brand-500 blur-[100px] sm:blur-[150px] opacity-40 animate-breathe pointer-events-none"}),e.jsx(L,{user:t,onLogout:n,onClearCache:a}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("header",{className:"py-16 sm:py-24 text-center",children:[e.jsxs("h1",{className:"text-4xl sm:text-5xl font-semibold text-neutral-900 flex items-center justify-center gap-3 mb-3",children:[e.jsx(R,{className:"text-brand-600",size:40}),r.branding.title]}),e.jsx("p",{className:"text-lg text-neutral-600 max-w-2xl mx-auto px-4",children:r.branding.subtitle})]}),e.jsx("div",{className:"flex justify-center items-center py-20",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-neutral-200 border-t-brand-600 rounded-full animate-[spin_1s_linear_infinite]"}),e.jsx("p",{className:"text-neutral-600",children:"Loading applications..."})]})})]})]}):k?e.jsxs("div",{className:"relative min-h-screen",children:[e.jsx(L,{user:t,onLogout:n,onClearCache:a}),e.jsx("div",{className:"container py-8",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-800 rounded-xl p-6",children:[e.jsx("strong",{className:"font-semibold",children:"Error:"})," ",k]})})]}):e.jsxs("div",{className:"relative min-h-screen",children:[e.jsx("div",{className:"fixed top-[70%] left-[75%] -translate-x-1/2 -translate-y-1/2 w-[300px] h-[300px] sm:w-[600px] sm:h-[600px] rounded-full bg-brand-500 blur-[100px] sm:blur-[150px] opacity-40 animate-breathe pointer-events-none"}),e.jsx(L,{user:t,onLogout:n,onClearCache:a}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("header",{className:"py-16 sm:py-24 text-center",children:[e.jsxs("h1",{className:"text-4xl sm:text-5xl font-semibold text-neutral-900 flex items-center justify-center gap-3 mb-3",children:[e.jsx(R,{className:"text-brand-600",size:40}),r.branding.title]}),e.jsx("p",{className:"text-lg text-neutral-600 max-w-2xl mx-auto px-4",children:r.branding.subtitle})]}),e.jsx("div",{className:"container pb-20",children:e.jsx("div",{className:"grid",children:s.map(l=>e.jsx(B,{appName:l.name,manifest:l.manifest,path:l.path,onLaunch:O},l.name))})})]}),w&&e.jsxs(e.Fragment,{children:[e.jsx("iframe",{ref:h,className:"fixed inset-0 w-full h-full border-0 z-[9998]",style:{display:"block"},title:w.name}),H&&e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-[9999]",children:e.jsxs("div",{className:"flex flex-col items-center gap-4 text-white",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-white/30 border-t-white rounded-full animate-[spin_1s_linear_infinite]"}),e.jsx("p",{className:"text-lg",children:"Loading app..."})]})}),e.jsx("div",{className:`fixed bottom-6 left-1/2 -translate-x-1/2 bg-black/90 text-white px-6 py-3 rounded-full text-sm flex items-center gap-2 transition-all duration-300 z-[10000] ${G?"opacity-100 visible":"opacity-0 invisible"}`,children:"Press ESC to return to gallery"})]})]})}function se(){const r=$(),{user:t,token:o,isAuthenticated:d,setAuth:n,logout:a}=D(),{clearCache:c}=I(),{track:p}=U();return e.jsx(W,{oauthServiceUrl:y.oauth.serviceUrl,onAuthChange:(s,x)=>{s&&x&&n(s,x)},isAuthenticated:d,children:e.jsx(Q,{config:y,user:t,token:o,useGitHubAPI:V,onLogout:a,onClearCache:()=>c(y.repository.owner,y.repository.name),onTrack:p,onNavigate:s=>r(s)})})}export{se as default};
