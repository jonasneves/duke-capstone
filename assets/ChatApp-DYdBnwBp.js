import{j as c,u as C}from"./main-CgD8xkQn.js";import{r as n}from"./state-DOKsaQ-a.js";import{A as M}from"./ui-D_bnl3Nn.js";import{u as N}from"./usePerformanceMonitor-BBzgtPhB.js";import"./vendor-CZvkgD4c.js";const w=n.memo(({message:e,style:r})=>{const s="px-5 py-3.5 rounded-2xl text-base leading-relaxed max-w-[85%]",t={user:"ml-auto bg-neutral-900 text-white",assistant:"mr-auto bg-white border border-neutral-200 text-neutral-900 shadow-sm",system:"mx-auto bg-amber-50 border border-amber-200 text-amber-800 text-center text-sm"};return c.jsx("div",{style:r,className:`${s} ${t[e.role]}`,"data-role":e.role,children:e.content})});w.displayName="MessageBubble";function A({messages:e}){const r=n.useRef(null),s=n.useRef(!0);n.useEffect(()=>{s.current&&r.current&&(r.current.scrollTop=r.current.scrollHeight)},[e]);const t=()=>{if(!r.current)return;const{scrollTop:a,scrollHeight:u,clientHeight:o}=r.current,l=Math.abs(u-o-a)<50;s.current=l};return c.jsx("div",{ref:r,className:"flex-1 overflow-y-auto px-6 py-6 space-y-4 max-w-4xl mx-auto w-full",id:"chat",onScroll:t,children:e.map((a,u)=>c.jsx(w,{message:a},a.id||u))})}function E({onSend:e,disabled:r}){const[s,t]=n.useState(""),a=n.useRef(null);n.useEffect(()=>{r||a.current?.focus()},[r]);const u=()=>{const l=s.trim();!l||r||(e(l),t(""),a.current?.focus())},o=l=>{l.key==="Enter"&&!l.shiftKey&&(l.preventDefault(),u())};return c.jsx("div",{className:"bg-neutral-50 px-6 py-6",children:c.jsxs("div",{className:"relative max-w-5xl mx-auto",children:[c.jsx("input",{ref:a,type:"text",id:"input",value:s,onChange:l=>t(l.target.value),onKeyDown:o,placeholder:"Type your message...",disabled:r,className:"w-full px-6 py-4 pr-16 bg-white border border-neutral-200 rounded-full text-base focus:outline-none focus:ring-2 focus:ring-neutral-300 focus:border-neutral-300 disabled:bg-neutral-100 disabled:text-neutral-400 shadow-sm"}),c.jsx("button",{onClick:u,disabled:r||!s.trim(),id:"send-btn",className:"absolute right-2 top-1/2 -translate-y-1/2 w-10 h-10 flex items-center justify-center bg-neutral-900 hover:bg-neutral-800 text-white rounded-full transition-colors disabled:bg-neutral-300 disabled:cursor-not-allowed shadow-sm","aria-label":"Send message",children:c.jsx(M,{size:18})})]})})}const k=[{value:"gpt-4o",label:"GPT-4o"},{value:"gpt-4o-mini",label:"GPT-4o Mini"},{value:"meta-llama-3.1-70b-instruct",label:"Llama 3.1 70B"},{value:"mistral-large",label:"Mistral Large"}];function R({selectedModel:e,onModelChange:r,onClearChat:s}){return c.jsxs("div",{className:"flex items-center gap-3 px-6 py-3 bg-white border-b border-neutral-100",children:[c.jsx("label",{htmlFor:"model",className:"text-sm font-medium text-neutral-600",children:"Model:"}),c.jsx("select",{id:"model",value:e,onChange:t=>r(t.target.value),className:"px-3 py-1.5 text-sm border border-neutral-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-neutral-300 focus:border-neutral-300 bg-white",children:k.map(t=>c.jsx("option",{value:t.value,children:t.label},t.value))}),c.jsx("button",{onClick:s,className:"ml-auto px-3 py-1.5 text-sm text-neutral-600 hover:text-neutral-900 hover:bg-neutral-50 rounded-lg transition-colors",children:"Clear Chat"})]})}function $(e,r={}){const{maxBatchSize:s=1/0}=r,t=n.useRef([]),a=n.useRef(void 0),u=n.useCallback(l=>{const d=Array.isArray(l)?l:[l];if(t.current.push(...d),t.current.length>=s){a.current!==void 0&&(cancelAnimationFrame(a.current),a.current=void 0),e(t.current),t.current=[];return}a.current||(a.current=requestAnimationFrame(()=>{e(t.current),t.current=[],a.current=void 0}))},[e,s]),o=n.useCallback(()=>{a.current!==void 0&&(cancelAnimationFrame(a.current),a.current=void 0),t.current.length>0&&(e(t.current),t.current=[])},[e]);return n.useEffect(()=>()=>{a.current!==void 0&&cancelAnimationFrame(a.current)},[]),{accumulate:u,flush:o}}function p(e,r){const[s,t]=n.useState(()=>{try{const o=window.localStorage.getItem(e);return o?JSON.parse(o):r}catch(o){return console.warn(`Error reading localStorage key "${e}":`,o),r}}),a=n.useCallback(o=>{try{t(l=>{const d=o instanceof Function?o(l):o;return window.localStorage.setItem(e,JSON.stringify(d)),d})}catch(l){console.warn(`Error setting localStorage key "${e}":`,l)}},[e]),u=n.useCallback(()=>{try{window.localStorage.removeItem(e),t(r)}catch(o){console.warn(`Error removing localStorage key "${e}":`,o)}},[e,r]);return[s,a,u]}function B(){const e=C(m=>m.token),{startTimer:r,endTimer:s}=N("chat"),[t,a,u]=p("chat_history",[]),[o,l]=p("chat_model","gpt-4o-mini"),[d,x]=n.useState(!1);n.useEffect(()=>{s("ttfr")},[s]);const y=n.useCallback(m=>{a(i=>[...i,...m])},[a]),{accumulate:b}=$(y),f=n.useCallback((m,i)=>{const g={role:m,content:i,id:`${Date.now()}-${Math.random()}`};b(g)},[b]),v=n.useCallback(async m=>{if(!(!e||d)){x(!0),f("user",m);try{r("api_latency_ms");const i=await fetch("https://models.inference.ai.azure.com/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({model:o,messages:[...t,{role:"user",content:m}].map(h=>({role:h.role,content:h.content})),temperature:.7,max_tokens:1e3})});if(!i.ok){const h=await i.json().catch(()=>({error:{message:`API error: ${i.status}`}}));throw new Error(h.error?.message||`API error: ${i.status}`)}const j=(await i.json()).choices[0].message.content;s("api_latency_ms"),f("assistant",j)}catch(i){f("system",`Error: ${i.message}`)}finally{x(!1)}}},[e,o,t,d,f,r,s]),S=n.useCallback(()=>{confirm("Clear all chat history?")&&u()},[u]);return c.jsxs("div",{className:"h-screen flex flex-col bg-neutral-50",children:[c.jsxs("div",{className:"bg-white border-b border-neutral-100 px-6 py-4",children:[c.jsx("h1",{className:"text-xl font-semibold text-neutral-900",children:"AI Chat"}),c.jsx("p",{className:"text-sm text-neutral-500",children:"Powered by GitHub Models"})]}),c.jsx(R,{selectedModel:o,onModelChange:l,onClearChat:S}),c.jsx(A,{messages:t}),c.jsx(E,{onSend:v,disabled:d})]})}export{B as default};
