import{j as c,u as j}from"./main--BmFQgzi.js";import{r as o}from"./state-DOKsaQ-a.js";import{A as M}from"./ui-D_bnl3Nn.js";import{u as A}from"./usePerformanceMonitor-zYJWoVO6.js";import"./vendor-CZvkgD4c.js";const w=o.memo(({message:e,style:r})=>{const n="px-5 py-3.5 rounded-2xl text-base leading-relaxed max-w-[85%]",t={user:"ml-auto bg-neutral-900 text-white",assistant:"mr-auto bg-white border border-neutral-200 text-neutral-900 shadow-sm",system:"mx-auto bg-amber-50 border border-amber-200 text-amber-800 text-center text-sm"};return c.jsx("div",{style:r,className:`${n} ${t[e.role]}`,"data-role":e.role,children:e.content})});w.displayName="MessageBubble";function N({messages:e}){const r=o.useRef(null),n=o.useRef(!0);o.useEffect(()=>{n.current&&r.current&&(r.current.scrollTop=r.current.scrollHeight)},[e]);const t=()=>{if(!r.current)return;const{scrollTop:a,scrollHeight:u,clientHeight:l}=r.current,s=Math.abs(u-l-a)<50;n.current=s};return c.jsx("div",{ref:r,className:"flex-1 overflow-y-auto px-6 py-6 space-y-4 max-w-4xl mx-auto w-full",id:"chat",onScroll:t,children:e.map((a,u)=>c.jsx(w,{message:a},a.id||u))})}function E({onSend:e,disabled:r}){const[n,t]=o.useState(""),a=o.useRef(null);o.useEffect(()=>{r||a.current?.focus()},[r]);const u=()=>{const s=n.trim();!s||r||(e(s),t(""),a.current?.focus())},l=s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),u())};return c.jsxs("div",{className:"bg-neutral-50 px-6 py-6 flex items-center gap-3 max-w-4xl mx-auto",children:[c.jsx("input",{ref:a,type:"text",id:"input",value:n,onChange:s=>t(s.target.value),onKeyDown:l,placeholder:"Type your message...",disabled:r,className:"flex-1 px-6 py-4 bg-white border border-neutral-200 rounded-full text-base focus:outline-none focus:ring-2 focus:ring-neutral-300 focus:border-neutral-300 disabled:bg-neutral-100 disabled:text-neutral-400 shadow-sm"}),c.jsx("button",{onClick:u,disabled:r||!n.trim(),id:"send-btn",className:"flex-shrink-0 w-12 h-12 flex items-center justify-center bg-neutral-900 hover:bg-neutral-800 text-white rounded-full transition-colors disabled:bg-neutral-300 disabled:cursor-not-allowed shadow-sm","aria-label":"Send message",children:c.jsx(M,{size:20})})]})}const k=[{value:"gpt-4o",label:"GPT-4o"},{value:"gpt-4o-mini",label:"GPT-4o Mini"},{value:"meta-llama-3.1-70b-instruct",label:"Llama 3.1 70B"},{value:"mistral-large",label:"Mistral Large"}];function R({selectedModel:e,onModelChange:r,onClearChat:n}){return c.jsxs("div",{className:"flex items-center gap-3 px-6 py-3 bg-white border-b border-neutral-100",children:[c.jsx("label",{htmlFor:"model",className:"text-sm font-medium text-neutral-600",children:"Model:"}),c.jsx("select",{id:"model",value:e,onChange:t=>r(t.target.value),className:"px-3 py-1.5 text-sm border border-neutral-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-neutral-300 focus:border-neutral-300 bg-white",children:k.map(t=>c.jsx("option",{value:t.value,children:t.label},t.value))}),c.jsx("button",{onClick:n,className:"ml-auto px-3 py-1.5 text-sm text-neutral-600 hover:text-neutral-900 hover:bg-neutral-50 rounded-lg transition-colors",children:"Clear Chat"})]})}function $(e,r={}){const{maxBatchSize:n=1/0}=r,t=o.useRef([]),a=o.useRef(void 0),u=o.useCallback(s=>{const m=Array.isArray(s)?s:[s];if(t.current.push(...m),t.current.length>=n){a.current!==void 0&&(cancelAnimationFrame(a.current),a.current=void 0),e(t.current),t.current=[];return}a.current||(a.current=requestAnimationFrame(()=>{e(t.current),t.current=[],a.current=void 0}))},[e,n]),l=o.useCallback(()=>{a.current!==void 0&&(cancelAnimationFrame(a.current),a.current=void 0),t.current.length>0&&(e(t.current),t.current=[])},[e]);return o.useEffect(()=>()=>{a.current!==void 0&&cancelAnimationFrame(a.current)},[]),{accumulate:u,flush:l}}function p(e,r){const[n,t]=o.useState(()=>{try{const l=window.localStorage.getItem(e);return l?JSON.parse(l):r}catch(l){return console.warn(`Error reading localStorage key "${e}":`,l),r}}),a=o.useCallback(l=>{try{const s=l instanceof Function?l(n):l;t(s),window.localStorage.setItem(e,JSON.stringify(s))}catch(s){console.warn(`Error setting localStorage key "${e}":`,s)}},[e,n]),u=o.useCallback(()=>{try{window.localStorage.removeItem(e),t(r)}catch(l){console.warn(`Error removing localStorage key "${e}":`,l)}},[e,r]);return[n,a,u]}function B(){const e=j(d=>d.token),{startTimer:r,endTimer:n}=A("chat"),[t,a,u]=p("chat_history",[]),[l,s]=p("chat_model","gpt-4o-mini"),[m,x]=o.useState(!1);o.useEffect(()=>{n("ttfr")},[n]);const y=o.useCallback(d=>{a(i=>[...i,...d])},[a]),{accumulate:b}=$(y),f=o.useCallback((d,i)=>{const g={role:d,content:i,id:`${Date.now()}-${Math.random()}`};b(g)},[b]),v=o.useCallback(async d=>{if(!(!e||m)){x(!0),f("user",d);try{r("api_latency_ms");const i=await fetch("https://models.inference.ai.azure.com/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({model:l,messages:[...t,{role:"user",content:d}].map(h=>({role:h.role,content:h.content})),temperature:.7,max_tokens:1e3})});if(!i.ok){const h=await i.json().catch(()=>({error:{message:`API error: ${i.status}`}}));throw new Error(h.error?.message||`API error: ${i.status}`)}const C=(await i.json()).choices[0].message.content;n("api_latency_ms"),f("assistant",C)}catch(i){f("system",`Error: ${i.message}`)}finally{x(!1)}}},[e,l,t,m,f,r,n]),S=o.useCallback(()=>{confirm("Clear all chat history?")&&u()},[u]);return c.jsxs("div",{className:"h-screen flex flex-col bg-neutral-50",children:[c.jsxs("div",{className:"bg-white border-b border-neutral-100 px-6 py-4",children:[c.jsx("h1",{className:"text-xl font-semibold text-neutral-900",children:"AI Chat"}),c.jsx("p",{className:"text-sm text-neutral-500",children:"Powered by GitHub Models"})]}),c.jsx(R,{selectedModel:l,onModelChange:s,onClearChat:S}),c.jsx(N,{messages:t}),c.jsx(E,{onSend:v,disabled:m})]})}export{B as default};
