import{j as e,A as y}from"./main--BmFQgzi.js";import{r as l}from"./state-DOKsaQ-a.js";import{F as N,a as F}from"./ui-D_bnl3Nn.js";import{u as k}from"./index-ChcGP1se.js";import{u as B}from"./usePerformanceMonitor-zYJWoVO6.js";import"./vendor-CZvkgD4c.js";function C({currentPath:t,onNavigate:o}){const s=[{name:"root",path:""}];if(t){const r=t.split("/").filter(Boolean);let i="";for(const n of r)i=i?`${i}/${n}`:n,s.push({name:n,path:i})}return e.jsx("div",{className:"flex items-center gap-2 px-4 py-3 mb-4 bg-white rounded-lg border border-neutral-200 text-sm",children:s.map((r,i)=>e.jsxs("span",{className:"flex items-center gap-2",children:[i>0&&e.jsx("span",{className:"text-neutral-400",children:"/"}),e.jsx("a",{href:"#",onClick:n=>{n.preventDefault(),o(r.path)},className:"text-brand-600 hover:text-brand-700 hover:underline transition-colors",children:r.name})]},r.path))})}function S(t){return t?t<1024?`${t} B`:t<1024*1024?`${(t/1024).toFixed(1)} KB`:`${(t/(1024*1024)).toFixed(1)} MB`:""}function E(t){return[...t].sort((o,s)=>o.type===s.type?o.name.localeCompare(s.name):o.type==="dir"?-1:1)}const j=l.memo(({file:t,onNavigate:o,style:s})=>{const r=t.type==="dir",i=r?e.jsx(N,{size:20}):e.jsx(F,{size:20}),n=r?"":S(t.size),c=()=>{r&&o(t.path)};return e.jsxs("div",{className:`flex items-center gap-3 px-4 py-3 border-b border-neutral-100 last:border-b-0 ${r?"cursor-pointer hover:bg-neutral-50 transition-colors":""}`,onClick:c,style:s,children:[e.jsx("span",{className:`flex-shrink-0 ${r?"text-brand-600":"text-neutral-400"}`,children:i}),e.jsx("span",{className:"flex-1 text-sm text-neutral-900 truncate",children:t.name}),n&&e.jsx("span",{className:"flex-shrink-0 text-xs text-neutral-500",children:n})]})});j.displayName="FileListItem";const m=56,v=5;function T({files:t,onNavigate:o}){const s=l.useRef(null),[r,i]=l.useState(0),[n,c]=l.useState(600);l.useEffect(()=>{if(!s.current)return;const a=()=>{s.current&&c(s.current.clientHeight)};return a(),window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[]);const h=a=>{i(a.currentTarget.scrollTop)},p=t.length*m,d=Math.max(0,Math.floor(r/m)-v),b=Math.min(t.length,Math.ceil((r+n)/m)+v),f=t.slice(d,b);return t.length<100?e.jsx("div",{className:"bg-white rounded-2xl border border-neutral-200 shadow-sm overflow-hidden",children:t.map(a=>e.jsx(j,{file:a,onNavigate:o},a.path))}):e.jsx("div",{ref:s,className:"bg-white rounded-2xl border border-neutral-200 shadow-sm overflow-auto",onScroll:h,style:{height:"600px"},children:e.jsx("div",{style:{height:p,position:"relative"},children:f.map((a,x)=>{const u=d+x;return e.jsx(j,{file:a,onNavigate:o,style:{position:"absolute",top:u*m,left:0,right:0,height:m}},a.path)})})})}function G(){const t=k(y.repository.owner,y.repository.name),{startTimer:o,endTimer:s}=B("file-browser"),[r,i]=l.useState(""),[n,c]=l.useState([]),[h,p]=l.useState(!0),[d,b]=l.useState(null);l.useEffect(()=>{f(r)},[r]);const f=async u=>{try{p(!0),b(null),o("directory_load_ms");const g=await t.listDirectory(u),w=E(g);s("directory_load_ms"),c(w)}catch(g){b(g.message)}finally{p(!1)}},a=l.useCallback(u=>{i(u)},[]),x=()=>{window.parent.postMessage("close-app","*")};return h&&n.length===0?e.jsxs("div",{className:"min-h-screen bg-neutral-50",children:[e.jsxs("div",{className:"bg-white border-b border-neutral-200 px-6 py-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-semibold text-neutral-900",children:"File Browser"}),e.jsx("button",{className:"px-4 py-2 bg-white hover:bg-neutral-100 border border-neutral-300 text-neutral-700 rounded-lg font-medium text-sm transition-colors",onClick:x,children:"← Back to Gallery"})]}),e.jsx("div",{className:"max-w-5xl mx-auto px-6 py-8",children:e.jsx("div",{className:"text-center text-neutral-500 py-8",children:"Loading files..."})})]}):d?e.jsxs("div",{className:"min-h-screen bg-neutral-50",children:[e.jsxs("div",{className:"bg-white border-b border-neutral-200 px-6 py-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-semibold text-neutral-900",children:"File Browser"}),e.jsx("button",{className:"px-4 py-2 bg-white hover:bg-neutral-100 border border-neutral-300 text-neutral-700 rounded-lg font-medium text-sm transition-colors",onClick:x,children:"← Back to Gallery"})]}),e.jsx("div",{className:"max-w-5xl mx-auto px-6 py-8",children:e.jsxs("div",{className:"text-center text-red-600 py-8",children:["Error: ",d,e.jsx("br",{}),e.jsx("button",{className:"mt-4 px-4 py-2 bg-brand-600 hover:bg-brand-700 text-white rounded-lg font-medium text-sm transition-colors",onClick:()=>f(r),children:"Retry"})]})})]}):e.jsxs("div",{className:"min-h-screen bg-neutral-50",children:[e.jsxs("div",{className:"bg-white border-b border-neutral-200 px-6 py-4 flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-semibold text-neutral-900",children:"File Browser"}),e.jsx("button",{className:"px-4 py-2 bg-white hover:bg-neutral-100 border border-neutral-300 text-neutral-700 rounded-lg font-medium text-sm transition-colors",onClick:x,children:"← Back to Gallery"})]}),e.jsxs("div",{className:"max-w-5xl mx-auto px-6 py-8",children:[e.jsx(C,{currentPath:r,onNavigate:a}),h?e.jsx("div",{className:"text-center text-neutral-500 py-8",children:"Loading..."}):n.length===0?e.jsx("div",{className:"bg-white rounded-2xl border border-neutral-200 shadow-sm",children:e.jsx("div",{className:"text-center text-neutral-400 py-8",children:"This directory is empty"})}):e.jsx(T,{files:n,onNavigate:a})]})]})}export{G as default};
