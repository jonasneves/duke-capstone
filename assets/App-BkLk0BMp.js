import{r as x,j as e,k as R,l as z,m as A,u as C}from"./react-vendor-Cz34A0j2.js";import{U as v,u as E,b as T,a as U,A as f}from"./index-C8fxzHc6.js";import{u as $}from"./index-6Rpx_sQN.js";import"./vendor-7OC5HNn7.js";import"./state-CWLQzQDb.js";function D({children:r,oauthServiceUrl:t,onAuthChange:l,isAuthenticated:o}){const[a,n]=x.useState(!0),[i,m]=x.useState(!1);return x.useEffect(()=>{const s=document.createElement("script");return s.src=`${t}/github-auth.js?v=${Date.now()}`,s.async=!0,s.onload=()=>{setTimeout(()=>{window.GitHubAuth?m(!0):(console.error("GitHubAuth not available after script load"),n(!1))},100)},s.onerror=()=>{console.error("Failed to load OAuth script"),n(!1)},document.head.appendChild(s),()=>{document.head.contains(s)&&document.head.removeChild(s)}},[t]),x.useEffect(()=>{if(i)if(window.GitHubAuth.isAuthenticated()){const s=window.GitHubAuth.getUser(),c=window.GitHubAuth.getToken();s&&c&&setTimeout(()=>{l(c,s),n(!1)},0)}else window.GitHubAuth.init({scope:"repo",onLogin:s=>{const c=window.GitHubAuth.getUser();c&&setTimeout(()=>{l(s,c),n(!1)},0)}}),n(!1)},[i,l]),a?e.jsx("div",{className:"loading",children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{border:"4px solid rgba(255,255,255,0.3)",borderRadius:"50%",borderTopColor:"white",width:"50px",height:"50px",animation:"spin 1s linear infinite",margin:"0 auto 20px"}}),e.jsx("p",{children:"Initializing..."})]})}):o?e.jsx(e.Fragment,{children:r}):e.jsx("div",{className:"loading",children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("h2",{children:"Authentication Required"}),e.jsx("p",{style:{marginTop:16,marginBottom:24,opacity:.9},children:"Please sign in with GitHub to access the gallery"}),e.jsx("button",{onClick:()=>window.GitHubAuth.login(),style:{background:"linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)",color:"white",border:"none",padding:"12px 24px",borderRadius:"8px",fontSize:"16px",fontWeight:"500",cursor:"pointer"},children:"Sign in with GitHub"})]})})}function _(r,t){if(!r?.minLauncherVersion||!t)return null;const l=t.split(".").map(Number),o=r.minLauncherVersion.split(".").map(Number);for(let a=0;a<3;a++){if(l[a]<o[a])return`Requires launcher v${r.minLauncherVersion}`;if(l[a]>o[a])return null}return null}function q({appName:r,manifest:t,path:l,onLaunch:o,version:a}){if(!t)return e.jsx("div",{className:"bg-white rounded-2xl border border-neutral-200 shadow-sm overflow-hidden",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-neutral-900 mb-2",children:r}),e.jsx("p",{className:"text-neutral-400",children:"Loading..."})]})});const n=_(t,a);return e.jsxs("div",{className:"bg-white rounded-xl border border-neutral-200 shadow-sm hover:shadow-md hover:-translate-y-0.5 transition-all duration-200 overflow-hidden group flex flex-col h-full",children:[e.jsx("div",{className:`w-full bg-gradient-to-br from-brand-50 to-neutral-50 flex items-center justify-center ${t.thumbnail?"h-32":"h-20"}`,children:t.thumbnail?e.jsx("img",{src:t.thumbnail,alt:t.name,loading:"lazy",className:"w-full h-full object-cover",onError:i=>{i.currentTarget.style.display="none"}}):e.jsx("div",{className:"text-4xl text-neutral-400",children:t.name.charAt(0)})}),e.jsxs("div",{className:"p-4 flex flex-col flex-1",children:[e.jsx("h3",{className:"text-base font-semibold text-neutral-900 mb-1",children:t.name}),e.jsx("p",{className:"text-neutral-600 text-xs leading-relaxed mb-3 line-clamp-2",children:t.description}),n&&e.jsxs("div",{className:"flex items-center gap-1.5 text-amber-600 text-xs mb-3 bg-amber-50 px-2 py-1.5 rounded",children:[e.jsx(R,{size:12}),e.jsx("span",{className:"text-[10px]",children:n})]}),t.tech&&t.tech.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1.5 mb-3",children:t.tech.map(i=>e.jsx("span",{className:"bg-neutral-100 text-neutral-700 px-2 py-0.5 rounded-full text-[10px] font-medium",children:i},i))}),e.jsxs("button",{onClick:()=>o(l,t.name),"aria-label":`Launch ${t.name} app`,className:"inline-flex items-center justify-center gap-1.5 bg-gradient-to-r from-brand-600 to-brand-700 hover:from-brand-700 hover:to-brand-800 text-white px-3 py-2 rounded-lg font-medium text-xs transition-all duration-200 group-hover:gap-2 mt-auto",children:["Launch App",e.jsx(z,{size:14,className:"transition-transform duration-200"})]})]})]})}function I({config:r,user:t,useGitHubAPI:l,onLogout:o,onClearCache:a,onTrack:n,onNavigate:i}){const[m,s]=x.useState([]),[c,g]=x.useState(!0),[N,L]=x.useState(null),w=l(r.repository.owner,r.repository.name);x.useEffect(()=>{S()},[]);const S=async()=>{try{g(!0);const p=(await w.listDirectory("apps")).filter(u=>u.type==="dir"),b=p.map(u=>({name:u.name,path:u.path,manifest:null}));s(b);const j=p.map(async u=>{const h=await w.getManifest(u.path);return{name:u.name,manifest:h}}),H=await Promise.all(j);s(u=>u.map(h=>{const y=H.find(k=>k.name===h.name);return y?.manifest?{...h,manifest:y.manifest}:h})),g(!1)}catch(d){L(d.message),g(!1)}},G=x.useCallback((d,p)=>{n?.("app_launch",{appName:p,appPath:d});const b=m.find(j=>j.path===d)?.manifest;b?.reactRoute&&i&&i(b.reactRoute)},[m,n,i]);return c&&m.length===0?e.jsxs("div",{className:"relative min-h-screen",children:[e.jsx("div",{className:"fixed top-[70%] left-[75%] -translate-x-1/2 -translate-y-1/2 w-[300px] h-[300px] sm:w-[600px] sm:h-[600px] rounded-full bg-brand-500 blur-[100px] sm:blur-[150px] opacity-40 animate-breathe pointer-events-none"}),e.jsx(v,{user:t,onLogout:o,onClearCache:a}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("header",{className:"py-16 sm:py-24 text-center",children:[e.jsxs("h1",{className:"text-4xl sm:text-5xl font-semibold text-neutral-900 flex items-center justify-center gap-3 mb-3",children:[e.jsx(A,{className:"text-brand-600",size:40}),r.branding.title]}),e.jsx("p",{className:"text-lg text-neutral-600 max-w-2xl mx-auto px-4",children:r.branding.subtitle})]}),e.jsx("div",{className:"flex justify-center items-center py-20",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-neutral-200 border-t-brand-600 rounded-full animate-[spin_1s_linear_infinite]"}),e.jsx("p",{className:"text-neutral-600",children:"Loading applications..."})]})})]})]}):N?e.jsxs("div",{className:"relative min-h-screen",children:[e.jsx(v,{user:t,onLogout:o,onClearCache:a}),e.jsx("div",{className:"container py-8",children:e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-800 rounded-xl p-6",children:[e.jsx("strong",{className:"font-semibold",children:"Error:"})," ",N]})})]}):e.jsxs("div",{className:"relative min-h-screen",children:[e.jsx("div",{className:"fixed top-[70%] left-[75%] -translate-x-1/2 -translate-y-1/2 w-[300px] h-[300px] sm:w-[600px] sm:h-[600px] rounded-full bg-brand-500 blur-[100px] sm:blur-[150px] opacity-40 animate-breathe pointer-events-none"}),e.jsx(v,{user:t,onLogout:o,onClearCache:a}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("header",{className:"py-16 sm:py-24 text-center",children:[e.jsxs("h1",{className:"text-4xl sm:text-5xl font-semibold text-neutral-900 flex items-center justify-center gap-3 mb-3",children:[e.jsx(A,{className:"text-brand-600",size:40}),r.branding.title]}),e.jsx("p",{className:"text-lg text-neutral-600 max-w-2xl mx-auto px-4",children:r.branding.subtitle})]}),e.jsx("div",{className:"container pb-20",children:e.jsx("div",{className:"grid",children:m.map(d=>e.jsx(q,{appName:d.name,manifest:d.manifest,path:d.path,onLaunch:G},d.name))})})]})]})}function W(){const r=C(),{user:t,token:l,isAuthenticated:o,setAuth:a,logout:n}=E(),{clearCache:i}=T(),{track:m}=U();return e.jsx(D,{oauthServiceUrl:f.oauth.serviceUrl,onAuthChange:(s,c)=>{s&&c&&a(s,c)},isAuthenticated:o,children:e.jsx(I,{config:f,user:t,token:l,useGitHubAPI:$,onLogout:n,onClearCache:()=>i(f.repository.owner,f.repository.name),onTrack:m,onNavigate:s=>r(s)})})}export{W as default};
