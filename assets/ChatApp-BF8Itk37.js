import{j as l,u as C}from"./main-BFfeUCmg.js";import{r as c}from"./state-DOKsaQ-a.js";import{u as j}from"./usePerformanceMonitor-BK8VJ-1X.js";import"./vendor-CZvkgD4c.js";const y=c.memo(({message:e,style:r})=>{const a="px-4 py-3 rounded-lg text-sm leading-relaxed max-w-[80%]",t={user:"ml-auto bg-brand-600 text-white",assistant:"mr-auto bg-white border border-neutral-200 text-neutral-900",system:"mx-auto bg-amber-50 border border-amber-200 text-amber-800 text-center"};return l.jsx("div",{style:r,className:`${a} ${t[e.role]}`,"data-role":e.role,children:e.content})});y.displayName="MessageBubble";function M({messages:e}){const r=c.useRef(null),a=c.useRef(!0);c.useEffect(()=>{a.current&&r.current&&(r.current.scrollTop=r.current.scrollHeight)},[e]);const t=()=>{if(!r.current)return;const{scrollTop:n,scrollHeight:u,clientHeight:s}=r.current,o=Math.abs(u-s-n)<50;a.current=o};return l.jsx("div",{ref:r,className:"flex-1 overflow-y-auto px-6 py-4 space-y-4",id:"chat",onScroll:t,children:e.map((n,u)=>l.jsx(y,{message:n},n.id||u))})}function N({onSend:e,disabled:r}){const[a,t]=c.useState(""),n=c.useRef(null);c.useEffect(()=>{r||n.current?.focus()},[r]);const u=()=>{const o=a.trim();!o||r||(e(o),t(""),n.current?.focus())},s=o=>{o.key==="Enter"&&!o.shiftKey&&(o.preventDefault(),u())};return l.jsxs("div",{className:"border-t border-neutral-200 bg-white px-6 py-4 flex items-center gap-3",children:[l.jsx("input",{ref:n,type:"text",id:"input",value:a,onChange:o=>t(o.target.value),onKeyDown:s,placeholder:"Type your message...",disabled:r,className:"flex-1 px-4 py-2.5 border border-neutral-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-brand-500 disabled:bg-neutral-100 disabled:text-neutral-400"}),l.jsx("button",{onClick:u,disabled:r||!a.trim(),id:"send-btn",className:"px-5 py-2.5 bg-brand-600 hover:bg-brand-700 text-white rounded-lg font-medium text-sm transition-colors disabled:bg-neutral-300 disabled:cursor-not-allowed",children:"Send"})]})}const A=[{value:"gpt-4o",label:"GPT-4o"},{value:"gpt-4o-mini",label:"GPT-4o Mini"},{value:"meta-llama-3.1-70b-instruct",label:"Llama 3.1 70B"},{value:"mistral-large",label:"Mistral Large"}];function E({selectedModel:e,onModelChange:r,onClearChat:a}){return l.jsxs("div",{className:"flex items-center gap-3 px-6 py-3 bg-white border-b border-neutral-200",children:[l.jsx("label",{htmlFor:"model",className:"text-sm font-medium text-neutral-700",children:"Model:"}),l.jsx("select",{id:"model",value:e,onChange:t=>r(t.target.value),className:"px-3 py-1.5 text-sm border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-500 focus:border-brand-500",children:A.map(t=>l.jsx("option",{value:t.value,children:t.label},t.value))}),l.jsx("button",{onClick:a,className:"ml-auto px-3 py-1.5 text-sm text-neutral-700 hover:text-neutral-900 hover:bg-neutral-100 rounded-lg transition-colors",children:"Clear Chat"})]})}function R(e,r={}){const{maxBatchSize:a=1/0}=r,t=c.useRef([]),n=c.useRef(void 0),u=c.useCallback(o=>{const m=Array.isArray(o)?o:[o];if(t.current.push(...m),t.current.length>=a){n.current!==void 0&&(cancelAnimationFrame(n.current),n.current=void 0),e(t.current),t.current=[];return}n.current||(n.current=requestAnimationFrame(()=>{e(t.current),t.current=[],n.current=void 0}))},[e,a]),s=c.useCallback(()=>{n.current!==void 0&&(cancelAnimationFrame(n.current),n.current=void 0),t.current.length>0&&(e(t.current),t.current=[])},[e]);return c.useEffect(()=>()=>{n.current!==void 0&&cancelAnimationFrame(n.current),t.current.length>0&&e(t.current)},[e]),{accumulate:u,flush:s}}function x(e,r){const[a,t]=c.useState(()=>{try{const s=window.localStorage.getItem(e);return s?JSON.parse(s):r}catch(s){return console.warn(`Error reading localStorage key "${e}":`,s),r}}),n=c.useCallback(s=>{try{const o=s instanceof Function?s(a):s;t(o),window.localStorage.setItem(e,JSON.stringify(o))}catch(o){console.warn(`Error setting localStorage key "${e}":`,o)}},[e,a]),u=c.useCallback(()=>{try{window.localStorage.removeItem(e),t(r)}catch(s){console.warn(`Error removing localStorage key "${e}":`,s)}},[e,r]);return[a,n,u]}function L(){const e=C(d=>d.token),{startTimer:r,endTimer:a}=j("chat"),[t,n,u]=x("chat_history",[]),[s,o]=x("chat_model","gpt-4o-mini"),[m,h]=c.useState(!1);c.useEffect(()=>{a("ttfr")},[a]);const{accumulate:g}=R(d=>{n(i=>[...i,...d])}),f=c.useCallback((d,i)=>{const p={role:d,content:i,id:`${Date.now()}-${Math.random()}`};g(p)},[g]),v=c.useCallback(async d=>{if(!(!e||m)){h(!0),f("user",d);try{r("api_latency_ms");const i=await fetch("https://models.inference.ai.azure.com/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({model:s,messages:[...t,{role:"user",content:d}].map(b=>({role:b.role,content:b.content})),temperature:.7,max_tokens:1e3})});if(!i.ok){const b=await i.json().catch(()=>({error:{message:`API error: ${i.status}`}}));throw new Error(b.error?.message||`API error: ${i.status}`)}const w=(await i.json()).choices[0].message.content;a("api_latency_ms"),f("assistant",w)}catch(i){f("system",`Error: ${i.message}`)}finally{h(!1)}}},[e,s,t,m,f,r,a]),S=c.useCallback(()=>{confirm("Clear all chat history?")&&u()},[u]);return l.jsxs("div",{className:"h-screen flex flex-col bg-neutral-50",children:[l.jsxs("div",{className:"bg-white border-b border-neutral-200 px-6 py-4",children:[l.jsx("h1",{className:"text-2xl font-semibold text-neutral-900",children:"AI Chat"}),l.jsx("p",{className:"text-sm text-neutral-600",children:"Powered by GitHub Models"})]}),l.jsx(E,{selectedModel:s,onModelChange:o,onClearChat:S}),l.jsx(M,{messages:t}),l.jsx(N,{onSend:v,disabled:m})]})}export{L as default};
